# Radiation Scanner Assistant   

* <b>   1.2.8.9</b>
1. Добавлена диагностика БД (66, 67, 68, 70). Если блок возвращает ошибку (не 0), то RSA переходит в режим "Простой", появляется диалог с информацией об ошибке, эта же инфа пишется в лог (только в режиме сканирования), также отображается в Info. Сама Info панель меняет цвет шрифта на красный
* <b>   1.2.8.8</b>
1. Изменен порядок отображения показаний для нейтрона: сейчас первым идет ск.с., затем м.д.
* <b>   1.2.8.7</b>
1. Добавлен пункт меню включающий отображение скорости счета раздельно для кадлого блока (нужно для поверки). Так как в БДТУ не показывает среднюю с.сч. для каждого канала, только мгновенную, то добавлено усреднение показаний по 10 измерений
* <b>   1.2.8.6</b>
1. В настройки добавлен переключатель, при активации которого, если к смартфону или БТДУ будет подключена зарядка, то приложение автоматом перейдет в режим "Простой"
* <b>   1.2.8.5</b>
1. При привышении порога по нейтрону в окне сообщений появляется соответствующее сообщение. Включается экран, если это разрешено пользователем
* <b>   1.2.8.4</b>  
2. Исправлена работа счетчиков тревог для гамма и нейтрона
* <b>   1.2.8.3</b>
1. "Автоматическая загрузка файлов на облако" переименовано в "Загрузка файлов на облако"
2. При переполнении по нейтрону, отображается "- - -"
* <b>   1.2.8.2</b>  
1. Переделано отображение в журнале: убраны лишние пустые строки; переведены все строки и названия параметров (Рус, Анг, Фра, Исп). Параметры теперь идут в алфавитном порядке (Map -> TreeMap). Добавлен пробел после даты
2. При превышении порога в инфо и в лог пишется "Тревога радиационной безопасности/Radiation safety alarm"
* <b>   1.2.8.1</b>  
2. Исправлено: AC (alarm count) было только на английском
3. Исправлено: если во время переполнения достать штекер от БДКГ-11М из БТДУ, это приводило к падению приложения
5. Исправлено: убрано отображение процента на облаке, если значение = 0%
* <b>   1.2.7.48</b>  
1. Исправлено: при запуске приложения часто сразу же говорило: "Gamma channel not connected", после чего нормально подключалось и уже говорило, что подключено. Бесило. Теперь при попытке подключения ждет 20 сек, прежде чем сказать, что "не подключено"
* <b>   1.2.7.47</b>  
1. Упорядочил код для перегрузки (CommunicationService)
2. Для спектрометрического режима: при любой перегрузке включается "beep тревоги"
* <b>   1.2.7.46</b>  
2. Для режима сканирования добавлен новый тип звукового сигнала: при любой перегрузке вместо пикания включается "Beep тревоги".
* <b>   1.2.7.45</b> 
1. Добавлена перегрузка для спектрометрического режима. Добавлена функция sayIfTimePassed
2. Исправлено: при переходе в режим перегрузки происходило завершение идентификации ДАЖЕ ЕСЛИ ДО ЭТОГО ИДЕНТИФИКАЦИЯ НЕ БЫЛА ЗАПУЩЕНА
* <b>   1.2.7.44</b>  
1. Добавлено: после отключения перегрузки возврат в 0-й режим отображения значения (мощность дозы). Только если до этого был включен H-режим
* <b>   1.2.7.42</b>  
2. Фраза "GAMMA_RADIATION_DETECTED" теперь звучит только один раз, раньше произносилась постоянно, пока превышен порог
* <b>   1.2.7.40</b>  
1. Если перегрузка по гамме или по мощности дозы, то при превышении порога в режиме сканирования идентификация включаться НЕ БУДЕТ
2. Исправил карусель режимов: заменил ==max на >=max, иначе если в режиме 3 или 4 отключить в настройках Шир, g_mode не переходил в 0 (будет 4, 5 ... и т.д. при max==3)
* <b>   1.2.7.38</b>  
1. Переделана логика перегрузки: теперь если перегружен только спектрометрический, но широкодиапазонный подключен, то "Gamma overload". Если перегружен Шир или перегружен Спек при неподключенном Шир, то "Dose rate overload"
2. При любой перегрузке отключается идентификация
* <b>   1.2.7.37</b>  
1. Добавлена перегрузка: по нейтрону, по гамме, по ШИРОКОДИАПАЗОННОМУ. Отображение в статусе, в логе, на месте "шарика" надпись "OL".
2. При перегрузке по гамме показания принудительно переключаются в HighDose (если подключен). Карусель режимов пропускает показания НЕ ПО широкодиапазонному каналу.
3. Добавлено: если широкодиапазонный не подключен, но включен в настройках, то будут отображаться "- - -" (раньше отображались нули)
4. Теперь если перегрузка по гамме, то значения МД окрашиваются красным, но значения по широкодиапазонному остаются белыми. ШД значения красные только при перегрузке по широкодиапазонному
* <b>   1.2.7.36</b>  
1. При идентификации неизвестного радионуклида произносится "Неизвестный", отображается в инфо, записываетися в лог, при открытии спектра отображается в списке найденных нуклидов, как "Неизвестный". Коэффициент достоверности для такого нуклида НЕ ОТОБРАЖАЕТСЯ. Цветная линия достоверности — во всю длину, синяя
2. Обновил все импорты
* <b>   1.2.7.35</b>  
1. Исправлено некоректное срабатывания Перегрузки. (Было: при срабатывании постоянно в лог записывалось по 2-3 раза в секунду) — срабатывало не на появление перегрузки, а на её наличие
2. При перегрузке пишет в лог, в инфо, в строку статуса
* <b>   1.2.7.34</b>  
1. Добавлено: при тапе на область показаний по гамме теперь карусель из пяти единиц (раньше три): МД, СС, Д, МД-Ш, СС-Ш. Если широкодиапазонный блок не подключен, в каруселе только 3 единицы (без широкодиапазонного)
* <b>   1.2.7.33</b>  
1. Добавлен счетчик тревог для гамма и нейтрона
2. Добавлено: переполнение по гамма и нейтрону теперь отображается в инфо, записывается в лог, при переполнении мигает соответствующий шарик (красный или синий)
* <b>   1.2.7.32</b>  
1. При выборе аккаунта отображается фото аккаунта.
2. Изменены надписи на кнопках в фрагменте лога, раньше было не очевидно, что делает каждая кнопка
* <b>   1.2.7.31</b>  
1. Добавлено: во время загрузки файлов на облако отображается процент загрузки файлов
2. Исправлено: новый английский текст отображался как русский, иконка облако на большом лэйауте отображалась, как очень маленькая
* <b>   1.2.7.30</b>  
1. Добавлена проверка на нажатие кнопки "Upload whole folder" — при нажатии кнопки запускается процесс загрузки папки проекта, при этом кнопка кнопка перестает включать загрузку, пока текущая загрузка не будет завершена
* <b>   1.2.7.29</b>  
1. Добавлено: можно регулировать скорость движения графика (5 градаций)
* <b>   1.2.7.30</b>
1. Добавлена проверка на нажатие кнопки "Upload whole folder" — при нажатии кнопки запускается процесс загрузки папки проекта, при этом кнопка кнопка перестает включать загрузку, пока текущая загрузка не будет завершена
2. (NuclideLibraryReader) Добавил запись в лог библиотеки, удобно для мониторинга, удобнее, чем запись в файл
* <b>   1.2.7.31</b>
1. Добавлено: во время загрузки файлов на облако отображается процент загрузки файлов
2. Исправлено: новый английский текст отображался как русский, иконка облако на большом лэйауте отображалась, как очень маленькая
* <b>   1.2.7.32</b>
1. При выборе аккаунта отображается фото аккаунта.
2. Изменены надписи на кнопках в фрагменте лога, раньше было не очевидно, что делает каждая кнопка
* <b>   1.2.7.33</b>
1. Добавлен счетчик тревог для гамма и нейтрона
2. Добавлено: переполнение по гамма и нейтрону теперь отображается в инфо, записывается в лог, при переполнении мигает соответствующий шарик (красный или синий)
* <b>   1.2.7.34</b>
1. Добавлено: при тапе на область показаний по гамме теперь карусель из пяти единиц (раньше три): МД, СС, Д, МД-Ш, СС-Ш. Если широкодиапазонный блок не подключен, в каруселе только 3 единицы (без широкодиапазонного)
* <b>   1.2.7.35</b>
1. Исправлено некоректное срабатывания Перегрузки. (Было: при срабатывании постоянно в лог записывалось по 2-3 раза в секунду) — срабатывало не на появление перегрузки, а на её наличие
2. При перегрузке пишет в лог, в инфо, в строку статуса
* <b>   1.2.7.36</b>
1. При идентификации неизвестного радионуклида произносится "Неизвестный", отображается в инфо, записываетися в лог, при открытии спектра отображается в списке найденных нуклидов, как "Неизвестный". Коэффициент достоверности для такого нуклида НЕ ОТОБРАЖАЕТСЯ. Цветная линия достоверности — во всю длину, синяя
* <b>   1.2.7.37</b>
1. Добавлена перегрузка: по нейтрону, по гамме, по ШИРОКОДИАПАЗОННОМУ. Отображение в статусе, в логе, на месте "шарика" надпись "OL".
2. При перегрузке по гамме показания принудительно переключаются в HighDose (если подключен). Карусель режимов пропускает показания НЕ ПО широкодиапазонному каналу.
3. Добавлено: если широкодиапазонный не подключен, но включен в настройках, то будут отображаться "- - -" (раньше отображались нули)
4. Теперь если перегрузка по гамме, то значения МД окрашиваются красным, но значения по широкодиапазонному остаются белыми. ШД значения красные только при перегрузке по широкодиапазонному
* <b>   1.2.7.38</b>
1. Переделана логика перегрузки: теперь если перегружен только спектрометрический, но широкодиапазонный подключен, то "Gamma overload". Если перегружен Шир или перегружен Спек при неподключенном Шир, то "Dose rate overload"
2. При любой перегрузке отключается идентификация
* <b>   1.2.7.40</b>
1. Если перегрузка по гамме или по мощности дозы, то при превышении порога в режиме сканирования идентификация включаться НЕ БУДЕТ
2. Исправил карусель режимов: заменил ==max на >=max, иначе если в режиме 3 или 4 отключить в настройках Шир, g_mode не переходил в 0 (будет 4, 5 ... и т.д. при max==3)
3. Переделана логика перегрузки широкодиапазонного блока (setGammaOverload и setDoseRateOverload) в зависимости от того подключен блок в настройках и/или подключен блок физически: подробности см. "H-overload description.png"
* <b>   1.2.7.44 </b>
1. Добавлено: после отключения перегрузки возврат в 0-й режим отображения значения (мощность дозы). Только если до этого был включен H-режим
* <b>   1.2.7.45</b>
1. Добавлена перегрузка для спектрометрического режима. Добавлена функция sayIfTimePassed
2. Исправлено: при переходе в режим перегрузки происходило завершение идентификации ДАЖЕ ЕСЛИ ДО ЭТОГО ИДЕНТИФИКАЦИЯ НЕ БЫЛА ЗАПУЩЕНА
* <b>   1.2.7.46</b>
1. Для режима сканирования добавлен новый тип звукового сигнала: при любой перегрузке вместо пикания включается "beep тревоги"
* <b>   1.2.8.1</b>
1. Исправлено: AC (alarm count) было только на английском
2. Исправлено: если во время переполнения достать штекер от БДКГ-11М из БТДУ, это приводило к падению приложения
3. Исправлено: при переполнении надпись "OL" размещалась не по середине высоты. Пришлось поменять внутренний LinearLayout на ConstraintLayout
4. Исправлено: убрано отображение процента на облаке, если значение = 0%
* <b>   1.2.8.2</b>
1. Переделано отображение в журнале: убраны лишние пустые строки; переведены все строки и названия параметров (Рус, Анг, Фра, Исп). Параметры теперь идут в алфавитном порядке (Map -> TreeMap). Добавлен пробел после даты
2. При превышении порога в инфо и в лог пишется "Тревога радиационной безопасности/Radiation safety alarm" (раньше писалось только в лог и только вариант "Alarm gamma", для любого языка)
* <b>   1.2.8.3</b>
1. "Автоматическая загрузка файлов на облако" переименовано в "Загрузка файлов на облако"
2. При переполнении по нейтрону, отображается "- - -"
* <b>   1.2.8.5</b>
1. При привышении порога по нейтрону в окне сообщений появляется соответствующее сообщение. Включается экран, если это разрешено пользователем
* <b>   1.2.8.6</b>
1. В настройки добавлен переключатель, при активации которого, если к смартфону или БТДУ будет подключена зарядка, то приложение автоматом перейдет в режим "Простой"
* <b>   1.2.8.7</b>
1. Добавлен пункт меню включающий отображение скорости счета раздельно для кадлого блока (нужно для поверки). Так как в БДТУ не показывает среднюю с.сч. для каждого канала, только мгновенную, то добавлено усреднение показаний по 10 измерений
* <b>   1.2.8.8</b>
1. Изменен порядок отображения показаний для нейтрона: сейчас первым идет ск.с., затем м.д.
* <b>   1.2.8.9</b>
1. Добавлена диагностика БД (66, 67, 68, 70). Если блок возвращает ошибку (не 0), то RSA переходит в режим "Простой", появляется диалог с информацией об ошибке (тип БД: шир/спек/сч/нейтр, имя: -11М, номер порта, код ошибки), эта же инфа пишется в лог (только в режиме сканирования), также отображается в Info. Сама Info панель меняет цвет шрифта на красный
* <b>   1.2.8.10 </b>
1. "Dose rate is less than one micro zivert per hour" теперь таймаут 20 сек, раньше не было никакого
2. Добавлен режим "Поверки": если включен, то можно подключать блоки без спектрометрического (можно подключить к БТДУ только БДКГ-35, или только нейтронник). Нужно для поверки (только)
3. Добавлена отдельная группа настроек "Для поверки"
* <b>   1.2.8.11</b>
1. Исправлено: в режиме проверки подключение одного БДКГ-35 приводило к перегрузке OL
* <b>   1.2.8.12 </b>
1. Добавлено для погрешности: если < 1%, то показывать 1 (показывало 0). Раньше такое было только для мощности дозы
* <b>   1.2.8.15</b>
1. При сохранении спектра добавлена проверка на запрещенные символы (пока только "/"). Если такой символ есть в названии, спектр сохраняться не будет, также будет выведено соответствующее сообщение
2. Исправлено: раньше ПРИ ПОПЫТКЕ сохранить спектр выводился тост о том, что идет сохранение, теперь выводится ПОСЛЕ УСПЕШНОГО сохранения (раньше получалось, что если спектр не получилось сохранить, то сообщение всё равно выводилось)
* <b>   1.2.8.16</b>
1. Главное: добавлена возможность подключать АТ6101ДР (напрямую без БТДУ), как в режиме сканирования, так и в спектрометрическом
2. Если подключенное устройство НЕ БТДУ, то команду управляющего сигнала не подается
3. Если g_cps_limit == 0 (т.е. не задан), то этот параметр игнорируется при проверке на перегрузку
4. Если при получении спектра пришел левый ответ на другую команду (было такое при подключении к 6101ДР, он отвечал о заряде акк-ра, при отсутствии запроса), то ответ игнорируется, а запрос оставшийся без ответа посылается опять
5. В фильтр найденных устройст добавлен "AT6101DR"
6. Если подключенное устройство — это AT6101DR, то выбирается набор команд для БДКГ-03 (getDataBDKG_03)
* <b>   1.2.8.17</b>
1. Если произошло LowMemoryPda или LowPowerPda или LowPowerAdapter или включение зарядки в режиме поверки, то в лог пишется соответстующая строка: "Стоп! ...". Конечный "Стоп" в этом случае не пишется (может и стОит)
2. Если в режиме сканирования вылетает ConnectingException или ResponseException, это событие запишется в лог
* <b>   1.2.8.18</b>
1. Изменен порог критического уровня заряда адаптера (при котором уже голосовое сообщение, но продолжаем работатьт) с 8 до 6
2. При срабатывании критического уровня заряда адаптера (<6%) пишется в лог предупреждение. Только один раз, следующее срабатывание порога игнорируется и в лог не пишется
* <b>   1.2.8.19</b>
1. Раньше в папку с данными копировались два файла библиотеки (стандартная и для SrI), теперь только одна (если подключен SrI, то для него, если что-то другое, то стандартная). Нужно было, так как при работе с данными (из другого приложения) не было очевидно, по какой из двух библиотек проходила идентификация. Теперь всё понятно — с той, которая находится в папке.
2. Время набора спектра для режима сканирования увеличено с 60 до 300 сек
* <b>   1.2.8.20</b>
1. ИсправленЫ ошибкИ алгоритма определения нужной библиотеки нуклидов, в зависимости от типа БД.
    - Добавлены варианты, когда блоки пропускаются: для счетных и нейтронных БД не нужна библиотека (раньше при подключении одновременно БДКГ-05С и БДКГ-04 выбиралась стандартная библиотека, а нужно было выбрать библиотеку для SrI).
    - Для кастомной библиотеки не выбирался путь при загрузке
2. "Порог безопасности ... канала" переименован в "Порог ... канала"
* <b>   1.2.8.21</b>
1. Исправлена ошибка двойного вывода нейтронного порога в лог
* <b>   1.2.8.23</b>
1. Исправлено: при первом чистом запуске приложения выскакивает "Ошибка библиотеки нуклидов"
* <b>   1.2.9.2</b>
1. При перегрузке по нейтрону вместо "- - -" теперь отображается "25000" в режиме скорости счета, в остальных режимах — текущие измерения
* <b>   1.2.9.3</b>
1. Исправлена реакция приложения на низкий заряд адаптера. Теперь при уровне заряда <8% каждые 2 минуты голосовое сообщение начинает предупреждать о низком заряде батареи и о том, что скоро приложение будет закрыто через несколько минут, при этом приложение будет продолжать работать. При достижении 3% приложение закрывается
